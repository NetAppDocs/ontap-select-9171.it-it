---
sidebar: sidebar 
permalink: concept_ha_mirroring.html 
keywords: ontap select, ha, high availability, synchronous replication, mirrored aggregates, write path, raid syncmirror, rsm 
summary: 'Previeni la perdita di dati utilizzando RAID SyncMirror (RSM), aggregati speculari e percorso di scrittura.' 
---
= ONTAP Select HA RSM e aggregati speculari
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Previeni la perdita di dati utilizzando RAID SyncMirror (RSM), aggregati speculari e percorso di scrittura.



== Replica sincrona

Il modello ONTAP HA si basa sul concetto di partner HA. ONTAP Select estende questa architettura al mondo dei server commodity non condivisi, utilizzando la funzionalità RAID SyncMirror (RSM) presente in ONTAP per replicare i blocchi di dati tra i nodi del cluster, fornendo due copie dei dati utente distribuite su una coppia HA.

Un cluster a due nodi con un mediatore può estendersi su due data center. Per maggiori informazioni, vedere la sezionelink:reference_plan_best_practices.html#two-node-stretched-ha-metrocluster-sds-best-practices["Buone pratiche per HA esteso a due nodi (MetroCluster SDS)"] .



== Aggregati speculari

Un cluster ONTAP Select è composto da due a otto nodi. Ogni coppia HA contiene due copie dei dati utente, replicate in modo sincrono tra i nodi tramite una rete IP. Questo mirroring è trasparente per l'utente ed è una proprietà dell'aggregato dati, configurato automaticamente durante il processo di creazione dell'aggregato dati.

Tutti gli aggregati in un cluster ONTAP Select devono essere sottoposti a mirroring per garantire la disponibilità dei dati in caso di failover di un nodo e per evitare un SPOF in caso di guasto hardware. Gli aggregati in un cluster ONTAP Select sono creati a partire da dischi virtuali forniti da ciascun nodo nella coppia HA e utilizzano i seguenti dischi:

* Un set locale di dischi (fornito dall'attuale nodo ONTAP Select )
* Un set di dischi speculari (fornito dal partner HA del nodo corrente)



NOTE: I dischi locali e mirror utilizzati per creare un aggregato mirror devono avere le stesse dimensioni. Questi aggregati sono denominati plex 0 e plex 1 (per indicare rispettivamente le coppie di mirror locale e remoto). I numeri effettivi dei plex possono variare a seconda dell'installazione.

Questo approccio è fondamentalmente diverso dal funzionamento dei cluster ONTAP standard. Questo si applica a tutti i dischi radice e dati all'interno del cluster ONTAP Select . L'aggregato contiene sia copie locali che copie mirror dei dati. Pertanto, un aggregato che contiene N dischi virtuali offre spazio di archiviazione univoco pari a N/2 dischi, poiché la seconda copia dei dati risiede su dischi univoci propri.

La figura seguente mostra una coppia HA all'interno di un cluster ONTAP Select a quattro nodi. All'interno di questo cluster è presente un singolo aggregato (test) che utilizza lo storage di entrambi i partner HA. Questo aggregato di dati è composto da due set di dischi virtuali: un set locale, fornito dal nodo del cluster proprietario ONTAP Select (Plex 0), e un set remoto, fornito dal partner di failover (Plex 1).

Plex 0 è il bucket che contiene tutti i dischi locali. Plex 1 è il bucket che contiene i dischi mirror, ovvero i dischi responsabili dell'archiviazione di una seconda copia replicata dei dati utente. Il nodo proprietario dell'aggregato contribuisce con i dischi a Plex 0, mentre il partner HA di quel nodo contribuisce con i dischi a Plex 1.

Nella figura seguente, è presente un aggregato mirrorato con due dischi. Il contenuto di questo aggregato viene replicato sui due nodi del cluster, con il disco locale NET-1.1 inserito nel bucket Plex 0 e il disco remoto NET-2.1 inserito nel bucket Plex 1. In questo esempio, il test dell'aggregato è di proprietà del nodo del cluster a sinistra e utilizza il disco locale NET-1.1 e il disco mirror del partner HA NET-2.1.

* ONTAP Select aggregato speculare*image:DDHA_03.jpg["ONTAP Select aggregato speculare"]


NOTE: Quando viene implementato un cluster ONTAP Select , tutti i dischi virtuali presenti sul sistema vengono assegnati automaticamente al plex corretto, senza richiedere all'utente alcun passaggio aggiuntivo per quanto riguarda l'assegnazione dei dischi. Ciò impedisce l'assegnazione accidentale di dischi a un plex errato e fornisce una configurazione ottimale dei dischi mirror.



== Scrivi percorso

Il mirroring sincrono dei blocchi di dati tra i nodi del cluster e il requisito di non perdere dati in caso di guasto del sistema hanno un impatto significativo sul percorso seguito da una scrittura in ingresso durante la propagazione attraverso un cluster ONTAP Select . Questo processo si compone di due fasi:

* Riconoscimento
* Destaging


Le scritture su un volume di destinazione avvengono tramite un LIF dati e vengono eseguite sulla partizione NVRAM virtualizzata, presente su un disco di sistema del nodo ONTAP Select , prima di essere confermate al client. In una configurazione HA, si verifica un passaggio aggiuntivo, poiché queste scritture NVRAM vengono immediatamente replicate sul partner HA del proprietario del volume di destinazione prima di essere confermate. Questo processo garantisce la coerenza del file system sul nodo partner HA, in caso di guasto hardware sul nodo originale.

Dopo che la scrittura è stata eseguita sulla NVRAM, ONTAP sposta periodicamente il contenuto di questa partizione sul disco virtuale appropriato, un processo noto come destaging. Questo processo avviene una sola volta, sul nodo del cluster proprietario del volume di destinazione, e non sul partner HA.

La figura seguente mostra il percorso di scrittura di una richiesta di scrittura in arrivo su un nodo ONTAP Select .

* Flusso di lavoro del percorso di scrittura ONTAP Select *image:DDHA_04.jpg["Flusso di lavoro del percorso di scrittura ONTAP Select"]

La conferma di scrittura in arrivo include i seguenti passaggi:

* Le scritture entrano nel sistema tramite un'interfaccia logica di proprietà del nodo ONTAP Select A.
* Le scritture vengono eseguite sulla NVRAM del nodo A e replicate sul partner HA, il nodo B.
* Una volta che la richiesta di I/O è presente su entrambi i nodi HA, la richiesta viene confermata al client.


Il destaging di ONTAP Select dalla NVRAM all'aggregato di dati (ONTAP CP) include i seguenti passaggi:

* Le scritture vengono trasferite dalla NVRAM virtuale all'aggregato di dati virtuali.
* Il motore Mirror replica in modo sincrono i blocchi su entrambi i plex.

