---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: ONTAP Select la configurazione vSwitch e i criteri di bilanciamento del carico per configurazioni con due e quattro NIC. 
---
= ONTAP Select la configurazione VMware vSphere vSwitch su ESXi
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP Select la configurazione vSwitch e i criteri di bilanciamento del carico per configurazioni con due e quattro NIC.

ONTAP Select supporta l'utilizzo di configurazioni vSwitch sia standard che distribuite. I vSwitch distribuiti supportano i costrutti di aggregazione di link (LACP). L'aggregazione di link è un costrutto di rete comune utilizzato per aggregare la larghezza di banda su più adattatori fisici. LACP è uno standard indipendente dal fornitore che fornisce un protocollo aperto per endpoint di rete che raggruppano gruppi di porte di rete fisiche in un unico canale logico. ONTAP Select può funzionare con gruppi di porte configurati come Link Aggregation Group (LAG). Tuttavia, NetApp consiglia di utilizzare le singole porte fisiche come semplici porte uplink (trunk) per evitare la configurazione LAG. In questi casi, le best practice per i vSwitch standard e distribuiti sono identiche.

Questa sezione descrive la configurazione vSwitch e i criteri di bilanciamento del carico da utilizzare sia nelle configurazioni con due NIC che in quelle con quattro NIC.

Quando si configurano i gruppi di porte da utilizzare con ONTAP Select, è necessario seguire le seguenti best practice: la policy di bilanciamento del carico a livello di gruppo di porte è basata sul percorso basato sull'ID della porta virtuale di origine. VMware consiglia di impostare STP su Portfast sulle porte dello switch connesse agli host ESXi.

Tutte le configurazioni vSwitch richiedono un minimo di due schede di rete fisiche raggruppate in un unico team NIC. ONTAP Select supporta un singolo collegamento da 10 Gb per cluster a due nodi. Tuttavia, NetApp consiglia di garantire la ridondanza hardware tramite l'aggregazione delle NIC.

Su un server vSphere, i team NIC sono il costrutto di aggregazione utilizzato per raggruppare più schede di rete fisiche in un unico canale logico, consentendo la condivisione del carico di rete tra tutte le porte membro. È importante ricordare che i team NIC possono essere creati senza il supporto dello switch fisico. Le policy di bilanciamento del carico e failover possono essere applicate direttamente a un team NIC, che non è a conoscenza della configurazione dello switch upstream. In questo caso, le policy vengono applicate solo al traffico in uscita.


NOTE: I canali porta statici non sono supportati con ONTAP Select. I canali abilitati LACP sono supportati con vSwitch distribuiti, ma l'utilizzo di LAG LACP potrebbe causare una distribuzione non uniforme del carico tra i membri del LAG.

Per i cluster a nodo singolo, ONTAP Deploy configura la VM ONTAP Select in modo che utilizzi un gruppo di porte per la rete esterna e lo stesso gruppo di porte o, facoltativamente, un gruppo di porte diverso per il traffico di gestione del cluster e dei nodi. Per i cluster a nodo singolo, è possibile aggiungere il numero desiderato di porte fisiche al gruppo di porte esterne come adattatori attivi.

Per i cluster multinodo, ONTAP Deploy configura ciascuna VM ONTAP Select per utilizzare uno o due gruppi di porte per la rete interna e, separatamente, uno o due gruppi di porte per la rete esterna. Il traffico di gestione del cluster e dei nodi può utilizzare lo stesso gruppo di porte del traffico esterno o, facoltativamente, un gruppo di porte separato. Il traffico di gestione del cluster e dei nodi non può condividere lo stesso gruppo di porte con il traffico interno.


NOTE: ONTAP Select supporta un massimo di quattro VMNIC.



== vSwitch standard o distribuito e quattro porte fisiche per nodo

In un cluster multinodo, a ciascun nodo possono essere assegnati quattro gruppi di porte. Ogni gruppo di porte ha una singola porta fisica attiva e tre porte fisiche in standby, come mostrato nella figura seguente.

*vSwitch con quattro porte fisiche per nodo*

image:DDN_08.jpg["vSwitch con quattro porte fisiche per nodo"]

L'ordine delle porte nell'elenco di standby è importante. La tabella seguente fornisce un esempio della distribuzione fisica delle porte nei quattro gruppi di porte.

*Configurazioni di rete minime e consigliate*

[cols="5*"]
|===
| Gruppo portuale | Esterno 1 | Esterno 2 | Interno 1 | Interno 2 


| Attivo | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| Standby 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| Standby 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| Standby 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
Le figure seguenti mostrano le configurazioni dei gruppi di porte di rete esterne dalla UI di vCenter (ONTAP-External e ONTAP-External2). Si noti che gli adattatori attivi provengono da schede di rete diverse. In questa configurazione, vmnic 4 e vmnic 5 sono porte doppie sulla stessa scheda di rete fisica, mentre vmnic 6 e vminc 7 sono porte doppie su una scheda di rete separata (le schede vnmic da 0 a 3 non vengono utilizzate in questo esempio). L'ordine delle schede di standby fornisce un failover gerarchico, con le porte della rete interna posizionate per ultime. L'ordine delle porte interne nell'elenco di standby viene analogamente scambiato tra i due gruppi di porte esterne.

*Parte 1: ONTAP Select le configurazioni del gruppo di porte esterne*

image:DDN_09.jpg["Parte 1: ONTAP Select le configurazioni del gruppo di porte esterne"]

*Parte 2: ONTAP Select le configurazioni del gruppo di porte esterne*

image:DDN_10.jpg["Parte 2: ONTAP Select le configurazioni del gruppo di porte esterne"]

Per una migliore leggibilità, le assegnazioni sono le seguenti:

[cols="2*"]
|===
| ONTAP- Esterno | ONTAP-Esterno2 


| Adattatori attivi: vmnic5 Adattatori in standby: vmnic7, vmnic4, vmnic6 | Adattatori attivi: vmnic7 Adattatori in standby: vmnic5, vmnic6, vmnic4 
|===
Le figure seguenti mostrano le configurazioni dei gruppi di porte di rete interni (ONTAP-Interno e ONTAP-Interno2). Si noti che gli adattatori attivi provengono da schede di rete diverse. In questa configurazione, vmnic 4 e vmnic 5 sono porte doppie sullo stesso ASIC fisico, mentre vmnic 6 e vmnic 7 sono porte doppie su un ASIC separato. L'ordine degli adattatori in standby fornisce un failover gerarchico, con le porte della rete esterna in fondo. L'ordine delle porte esterne nell'elenco in standby viene analogamente scambiato tra i due gruppi di porte interni.

*Parte 1: Configurazioni del gruppo di porte interne ONTAP Select *

image:DDN_11.jpg["Parte 1: ONTAP Select le configurazioni del gruppo di porte interne"]

*Parte 2: ONTAP Select gruppi di porte interne*

image:DDN_12.jpg["Parte 2: ONTAP Select gruppi di porte interne"]

Per una migliore leggibilità, le assegnazioni sono le seguenti:

[cols="2*"]
|===
| ONTAP- Interno | ONTAP-Interno2 


| Adattatori attivi: vmnic4 Adattatori in standby: vmnic6, vmnic5, vmnic7 | Adattatori attivi: vmnic6 Adattatori in standby: vmnic4, vmnic7, vmnic5 
|===


== vSwitch standard o distribuito e due porte fisiche per nodo

Quando si utilizzano due schede di rete ad alta velocità (25/40 Gb), la configurazione consigliata per i gruppi di porte è concettualmente molto simile alla configurazione con quattro adattatori da 10 Gb. È consigliabile utilizzare quattro gruppi di porte anche quando si utilizzano solo due adattatori fisici. Le assegnazioni dei gruppi di porte sono le seguenti:

[cols="5*"]
|===
| Gruppo portuale | Esterno 1 (e0a,e0b) | Interno 1 (e0c,e0e) | Interno 2 (e0d,e0f) | Esterno 2 (e0g) 


| Attivo | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Stand-by | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*vSwitch con due porte fisiche ad alta velocità (25/40 Gb) per nodo*

image:DDN_17.jpg["vSwitch con due porte fisiche ad alta velocità (25/40 Gb) per nodo"]

Quando si utilizzano due porte fisiche (10 Gb o meno), ogni gruppo di porte deve avere un adattatore attivo e un adattatore di standby configurati uno di fronte all'altro. La rete interna è presente solo per i cluster ONTAP Select multinodo. Per i cluster a nodo singolo, entrambi gli adattatori possono essere configurati come attivi nel gruppo di porte esterno.

L'esempio seguente mostra la configurazione di un vSwitch e dei due gruppi di porte responsabili della gestione dei servizi di comunicazione interna ed esterna per un cluster ONTAP Select multinodo. La rete esterna può utilizzare la VMNIC della rete interna in caso di interruzione di rete, poiché le VMNIC della rete interna fanno parte di questo gruppo di porte e sono configurate in modalità standby. Per la rete esterna, invece, avviene il contrario. Alternare le VMNIC attive e in standby tra i due gruppi di porte è fondamentale per il corretto failover delle VM ONTAP Select durante le interruzioni di rete.

*vSwitch con due porte fisiche (10 Gb o meno) per nodo*

image:DDN_13.jpg["vSwitch con due porte fisiche per nodo"]



== vSwitch distribuito con LACP

Quando si utilizzano vSwitch distribuiti nella propria configurazione, è possibile utilizzare LACP (sebbene non sia una best practice) per semplificare la configurazione di rete. L'unica configurazione LACP supportata richiede che tutte le VMNIC si trovino in un unico LAG. Lo switch fisico uplink deve supportare una dimensione MTU compresa tra 7.500 e 9.000 su tutte le porte del canale. Le reti ONTAP Select interne ed esterne devono essere isolate a livello di gruppo di porte. La rete interna deve utilizzare una VLAN non instradabile (isolata). La rete esterna può utilizzare VST, EST o VGT.

Gli esempi seguenti mostrano la configurazione vSwitch distribuita utilizzando LACP.

*Proprietà LAG quando si utilizza LACP*

image:DDN_14.jpg["Proprietà LAG quando si utilizza LACP"]

*Configurazioni di gruppi di porte esterne utilizzando un vSwitch distribuito con LACP abilitato*

image:DDN_15.jpg["Configurazioni di gruppi di porte esterne utilizzando un vSwitch distribuito con LACP abilitato"]

*Configurazioni di gruppi di porte interne utilizzando un vSwitch distribuito con LACP abilitato*

image:DDN_16.jpg["Configurazioni di gruppi di porte interne utilizzando un vSwitch distribuito con LACP abilitato"]


NOTE: LACP richiede la configurazione delle porte dello switch upstream come port channel. Prima di abilitare questa funzionalità sul vSwitch distribuito, assicurarsi che un port channel abilitato per LACP sia configurato correttamente.
