---
sidebar: sidebar 
permalink: concept_stor_swraid_local.html 
keywords: ontap select, software raid, local attached storage, protection 
summary: 'Il RAID software è un livello di astrazione RAID implementato all"interno dello stack software ONTAP . Fornisce le stesse funzionalità del livello RAID all"interno di una piattaforma ONTAP tradizionale come FAS. Il livello RAID esegue calcoli di parità delle unità e fornisce protezione contro i guasti delle singole unità all"interno di un nodo ONTAP Select .' 
---
= ONTAP Select i servizi di configurazione RAID software per l'archiviazione locale collegata
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Il RAID software è un livello di astrazione RAID implementato all'interno dello stack software ONTAP . Fornisce le stesse funzionalità del livello RAID all'interno di una piattaforma ONTAP tradizionale come FAS. Il livello RAID esegue calcoli di parità delle unità e fornisce protezione contro i guasti delle singole unità all'interno di un nodo ONTAP Select .

Indipendentemente dalle configurazioni RAID hardware, ONTAP Select offre anche un'opzione RAID software. Un controller RAID hardware potrebbe non essere disponibile o potrebbe non essere consigliabile in determinati ambienti, ad esempio quando ONTAP Select viene implementato su hardware di piccole dimensioni. Il RAID software amplia le opzioni di implementazione disponibili per includere tali ambienti. Per abilitare il RAID software nel tuo ambiente, ecco alcuni punti da ricordare:

* È disponibile con licenza Premium o Premium XL.
* Supporta solo unità SSD o NVMe (richiede la licenza Premium XL) per dischi dati e root ONTAP .
* Richiede un disco di sistema separato per la partizione di avvio della VM ONTAP Select .
+
** Scegli un disco separato, un'unità SSD o NVMe, per creare un datastore per i dischi di sistema (NVRAM, scheda Boot/CF, Coredump e Mediator in una configurazione multi-nodo).




[NOTE]
====
* I termini disco di servizio e disco di sistema sono usati in modo intercambiabile.
+
** I dischi di servizio sono dischi virtuali (VMDK) utilizzati nella VM ONTAP Select per gestire vari elementi, quali clustering, avvio e così via.
** I dischi di servizio sono fisicamente posizionati su un singolo disco fisico (denominato collettivamente disco fisico di servizio/sistema) visto dall'host. Tale disco fisico deve contenere un datastore DAS. ONTAP Deploy crea questi dischi di servizio per la VM ONTAP Select durante la distribuzione del cluster.


* Non è possibile separare ulteriormente i dischi di sistema ONTAP Select su più datastore o su più unità fisiche.
* Il RAID hardware non è obsoleto.


====


== Configurazione RAID software per l'archiviazione locale collegata

Quando si utilizza un RAID software, l'assenza di un controller RAID hardware è l'ideale, ma se un sistema dispone di un controller RAID esistente, deve rispettare i seguenti requisiti:

* È necessario disabilitare il controller RAID hardware in modo che i dischi possano essere presentati direttamente al sistema (JBOD). In genere, questa modifica può essere apportata nel BIOS del controller RAID.
* In alternativa, il controller RAID hardware dovrebbe essere in modalità SAS HBA. Ad esempio, alcune configurazioni del BIOS consentono la modalità "AHCI" oltre al RAID, che è possibile scegliere per abilitare la modalità JBOD. Questo consente un passthrough, in modo che le unità fisiche possano essere visualizzate così come sono sull'host.


A seconda del numero massimo di unità supportate dal controller, potrebbe essere necessario un controller aggiuntivo. In modalità SAS HBA, assicurarsi che il controller I/O (SAS HBA) supporti una velocità minima di 6 Gbps. Tuttavia, NetApp consiglia una velocità di 12 Gbps.

Non sono supportate altre modalità o configurazioni del controller RAID hardware. Ad esempio, alcuni controller consentono il supporto RAID 0, che può abilitare artificialmente il pass-through dei dischi, ma le implicazioni possono essere indesiderate. La dimensione supportata dei dischi fisici (solo SSD) è compresa tra 200 GB e 16 TB.


NOTE: Gli amministratori devono tenere traccia delle unità utilizzate dalla VM ONTAP Select e impedire l'uso involontario di tali unità sull'host.



== ONTAP Select dischi virtuali e fisici

Per le configurazioni con controller RAID hardware, la ridondanza dei dischi fisici è fornita dal controller RAID. ONTAP Select viene fornito con uno o più VMDK da cui l'amministratore ONTAP può configurare gli aggregati di dati. Questi VMDK sono suddivisi in striping in formato RAID 0, poiché l'utilizzo del RAID software ONTAP è ridondante, inefficiente e inefficace a causa della resilienza fornita a livello hardware. Inoltre, i VMDK utilizzati per i dischi di sistema si trovano nello stesso datastore dei VMDK utilizzati per archiviare i dati utente.

Quando si utilizza un RAID software, ONTAP Deploy presenta a ONTAP Select un set di VMDK e Raw Device Mappings [RDM] dei dischi fisici per SSD e dispositivi passthrough o DirectPath IO per NVMe.

Le figure seguenti mostrano questa relazione in modo più dettagliato, evidenziando la differenza tra i dischi virtualizzati utilizzati per gli interni della VM ONTAP Select e i dischi fisici utilizzati per archiviare i dati utente.

* ONTAP Select software RAID: utilizzo di dischi virtualizzati e RDM*

image:ST_18.PNG["ONTAP Select software RAID: utilizzo di dischi virtualizzati e RDM"]

I dischi di sistema (VMDK) risiedono nello stesso datastore e sullo stesso disco fisico. Il disco NVRAM virtuale richiede un supporto veloce e durevole. Pertanto, sono supportati solo datastore di tipo NVMe e SSD.

image:ST_19.PNG["ONTAP Select software RAID con unità NVMe: utilizzo di dischi virtualizzati e dispositivi passthrough"]

I dischi di sistema (VMDK) risiedono nello stesso datastore e sullo stesso disco fisico. Il disco NVRAM virtuale richiede un supporto veloce e durevole. Pertanto, sono supportati solo datastore di tipo NVMe e SSD. Quando si utilizzano unità NVMe per i dati, anche il disco di sistema dovrebbe essere un dispositivo NVMe per motivi di prestazioni. Un buon candidato per il disco di sistema in una configurazione completamente NVMe è una scheda Intel Optane.


NOTE: Con la versione attuale, non è possibile separare ulteriormente i dischi di sistema ONTAP Select su più datastore o più unità fisiche.

Ogni disco dati è suddiviso in tre parti: una piccola partizione root (stripe) e due partizioni di pari dimensioni per creare due dischi dati visibili nella VM ONTAP Select . Le partizioni utilizzano lo schema Root Data Data (RD2), come mostrato nelle figure seguenti per un cluster a singolo nodo e per un nodo in una coppia ad alta disponibilità (HA).

`P`indica un'unità di parità, `DP` indica un'unità a doppia parità e `S` indica un'unità di riserva.

*Partizionamento del disco RDD per cluster a nodo singolo*

image:ST_19.jpg["Partizionamento del disco RDD per cluster a nodo singolo"]

*Partizionamento del disco RDD per cluster multinodo (coppie HA)*

image:ST_20.jpg["Partizionamento del disco RDD per cluster multinodo (coppie HA)"]

Il software RAID ONTAP supporta i seguenti tipi di RAID: RAID 4, RAID-DP e RAID-TEC. Si tratta degli stessi costrutti RAID utilizzati dalle piattaforme FAS e AFF . Per il provisioning della root, ONTAP Select supporta solo RAID 4 e RAID-DP. Quando si utilizza RAID-TEC per l'aggregazione dei dati, la protezione complessiva è RAID-DP. ONTAP Select HA utilizza un'architettura shared-nothing che replica la configurazione di ciascun nodo sull'altro nodo. Ciò significa che ogni nodo deve memorizzare la propria partizione root e una copia della partizione root del suo peer. Un disco dati ha una singola partizione root. Ciò significa che il numero minimo di dischi dati varia a seconda che il nodo ONTAP Select faccia parte di una coppia HA.

Per i cluster a nodo singolo, tutte le partizioni dati vengono utilizzate per archiviare i dati locali (attivi). Per i nodi che fanno parte di una coppia HA, una partizione dati viene utilizzata per archiviare i dati locali (attivi) per quel nodo e la seconda partizione dati viene utilizzata per eseguire il mirroring dei dati attivi dal peer HA.



== Dispositivi passthrough (DirectPath IO) vs. Raw Device Maps (RDM)

Gli hypervisor ESX e KVM non supportano i dischi NVMe come Raw Device Map (RDM). Per consentire a ONTAP Select di assumere il controllo diretto dei dischi NVMe, è necessario configurare queste unità come dispositivi passthrough in ESX o KVM. Quando si configura un dispositivo NVMe come dispositivo passthrough, è necessario il supporto del BIOS del server e potrebbe essere necessario riavviare l'host. Inoltre, esistono limiti al numero di dispositivi passthrough che possono essere assegnati a ciascun host, che possono variare a seconda della piattaforma. Tuttavia, ONTAP Deploy limita questo numero a 14 dispositivi NVMe per nodo ONTAP Select . Ciò significa che la configurazione NVMe offre una densità di IOP (IOP/TB) molto elevata a scapito della capacità totale. In alternativa, se si desidera una configurazione ad alte prestazioni con maggiore capacità di storage, la configurazione consigliata prevede una VM ONTAP Select grandi dimensioni, una scheda INTEL Optane per il disco di sistema e un numero nominale di unità SSD per l'archiviazione dei dati.


NOTE: Per sfruttare appieno le prestazioni NVMe, è opportuno considerare le grandi dimensioni della VM ONTAP Select .

Esiste un'ulteriore differenza tra dispositivi passthrough e RDM. Gli RDM possono essere mappati a una VM in esecuzione. I dispositivi passthrough richiedono il riavvio della VM. Ciò significa che qualsiasi procedura di sostituzione di unità NVMe o di espansione della capacità (aggiunta di unità) richiederà il riavvio della VM ONTAP Select . L'operazione di sostituzione dell'unità e di espansione della capacità (aggiunta di unità) è gestita da un flusso di lavoro in ONTAP Deploy. ONTAP Deploy gestisce il riavvio ONTAP Select per cluster a nodo singolo e il failover/failover per coppie HA. Tuttavia, è importante notare la differenza tra lavorare con unità dati SSD (non sono richiesti riavvii/failover ONTAP Select ) e lavorare con unità dati NVMe (è richiesto il riavvio/failover ONTAP Select ).



== Provisioning di dischi fisici e virtuali

Per offrire un'esperienza utente più snella, ONTAP Deploy esegue automaticamente il provisioning dei dischi di sistema (virtuali) dal datastore specificato (disco di sistema fisico) e li collega alla VM ONTAP Select . Questa operazione avviene automaticamente durante la configurazione iniziale, in modo che la VM ONTAP Select possa avviarsi. Gli RDM vengono partizionati e l'aggregato root viene creato automaticamente. Se il nodo ONTAP Select fa parte di una coppia HA, le partizioni dati vengono automaticamente assegnate a un pool di storage locale e a un pool di storage mirror. Questa assegnazione avviene automaticamente sia durante le operazioni di creazione del cluster che durante le operazioni di aggiunta di storage.

Poiché i dischi dati sulla VM ONTAP Select sono associati ai dischi fisici sottostanti, la creazione di configurazioni con un numero maggiore di dischi fisici comporta implicazioni in termini di prestazioni.


NOTE: Il tipo di gruppo RAID dell'aggregato radice dipende dal numero di dischi disponibili. ONTAP Deploy seleziona il tipo di gruppo RAID appropriato. Se ha un numero sufficiente di dischi allocati al nodo, utilizza RAID-DP, altrimenti crea un aggregato radice RAID-4.

Quando si aggiunge capacità a una VM ONTAP Select tramite RAID software, l'amministratore deve considerare le dimensioni fisiche dell'unità e il numero di unità necessarie. Per i dettagli, vederelink:concept_stor_capacity_inc.html["Aumentare la capacità di archiviazione"] .

Analogamente ai sistemi FAS e AFF , è possibile aggiungere solo unità con capacità uguale o superiore a un gruppo RAID esistente. Le unità con capacità maggiore hanno le dimensioni corrette. Se si creano nuovi gruppi RAID, le dimensioni del nuovo gruppo RAID devono corrispondere a quelle del gruppo RAID esistente per garantire che le prestazioni complessive aggregate non peggiorino.



== Abbina un disco ONTAP Select al disco ESX o KVM corrispondente

I dischi ONTAP Select sono solitamente etichettati NET xy. È possibile utilizzare il seguente comando ONTAP per ottenere l'UUID del disco:

[source, cli]
----
<system name>::> disk show NET-1.1
Disk: NET-1.1
Model: Micron_5100_MTFD
Serial Number: 1723175C0B5E
UID: *500A0751:175C0B5E*:00000000:00000000:00000000:00000000:00000000:00000000:00000000:00000000
BPS: 512
Physical Size: 894.3GB
Position: shared
Checksum Compatibility: advanced_zoned
Aggregate: -
Plex: -This UID can be matched with the device UID displayed in the ‘storage devices’ tab for the ESX host
----
image:ST_21.jpg["Abbinamento di un disco ONTAP Select al disco ESX corrispondente"]

Nella shell ESXi o KVM, è possibile immettere il seguente comando per far lampeggiare il LED di un determinato disco fisico (identificato dal suo naa.unique-id).

[role="tabbed-block"]
====
.ESX
--
[source, cli]
----
esxcli storage core device set -d <naa_id> -l=locator -L=<seconds>
----
--
.KVM
--
[source, cli]
----
cat /sys/block/<block_device_id>/device/wwid
----
--
====


== Guasti multipli delle unità quando si utilizza il software RAID

È possibile che un sistema si trovi in una situazione in cui più unità risultano guaste contemporaneamente. Il comportamento del sistema dipende dalla protezione RAID complessiva e dal numero di unità guaste.

Un aggregato RAID4 può sopravvivere al guasto di un disco, un aggregato RAID-DP può sopravvivere al guasto di due dischi e un aggregato RAID-TEC può sopravvivere al guasto di tre dischi.

Se il numero di dischi guasti è inferiore al numero massimo di guasti supportato dal tipo di RAID e se è disponibile un disco di riserva, il processo di ricostruzione si avvia automaticamente. Se non sono disponibili dischi di riserva, l'aggregatore fornisce i dati in uno stato degradato finché non vengono aggiunti dischi di riserva.

Se il numero di dischi guasti è superiore al numero massimo di guasti supportato dal tipo di RAID, il plex locale viene contrassegnato come guasto e lo stato dell'aggregato risulta degradato. I dati vengono forniti dal secondo plex residente sul partner HA. Ciò significa che tutte le richieste di I/O per il nodo 1 vengono inviate tramite la porta di interconnessione del cluster e0e (iSCSI) ai dischi fisicamente presenti sul nodo 2. Se anche il secondo plex si guasta, l'aggregato viene contrassegnato come guasto e i dati non sono disponibili.

Un plex non funzionante deve essere eliminato e ricreato affinché il corretto mirroring dei dati riprenda. Si noti che un guasto multidisco che causa il degrado di un aggregato dati comporta anche il degrado di un aggregato root. ONTAP Select utilizza lo schema di partizionamento root-data-data (RDD) per suddividere ogni unità fisica in una partizione root e due partizioni dati. Pertanto, la perdita di uno o più dischi potrebbe avere un impatto su più aggregati, tra cui la root locale o la copia dell'aggregato root remoto, nonché l'aggregato dati locale e la copia dell'aggregato dati remoto.

Un plex non riuscito viene eliminato e ricreato nel seguente output di esempio:

[listing]
----
C3111E67::> storage aggregate plex delete -aggregate aggr1 -plex plex1
Warning: Deleting plex "plex1" of mirrored aggregate "aggr1" in a non-shared HA configuration will disable its synchronous mirror protection and disable
         negotiated takeover of node "sti-rx2540-335a" when aggregate "aggr1" is online.
Do you want to continue? {y|n}: y
[Job 78] Job succeeded: DONE

C3111E67::> storage aggregate mirror -aggregate aggr1
Info: Disks would be added to aggregate "aggr1" on node "sti-rx2540-335a" in the following manner:
      Second Plex
        RAID Group rg0, 5 disks (advanced_zoned checksum, raid_dp)
                                                            Usable Physical
          Position   Disk                      Type           Size     Size
          ---------- ------------------------- ---------- -------- --------
          shared     NET-3.2                   SSD               -        -
          shared     NET-3.3                   SSD               -        -
          shared     NET-3.4                   SSD         208.4GB  208.4GB
          shared     NET-3.5                   SSD         208.4GB  208.4GB
          shared     NET-3.12                  SSD         208.4GB  208.4GB

      Aggregate capacity available for volume use would be 526.1GB.
      625.2GB would be used from capacity license.
Do you want to continue? {y|n}: y

C3111E67::> storage aggregate show-status -aggregate aggr1
Owner Node: sti-rx2540-335a
 Aggregate: aggr1 (online, raid_dp, mirrored) (advanced_zoned checksums)
  Plex: /aggr1/plex0 (online, normal, active, pool0)
   RAID Group /aggr1/plex0/rg0 (normal, advanced_zoned checksums)
                                                              Usable Physical
     Position Disk                        Pool Type     RPM     Size     Size Status
     -------- --------------------------- ---- ----- ------ -------- -------- ----------
     shared   NET-1.1                      0   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-1.2                      0   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-1.3                      0   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-1.10                     0   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-1.11                     0   SSD        -  205.1GB  447.1GB (normal)
  Plex: /aggr1/plex3 (online, normal, active, pool1)
   RAID Group /aggr1/plex3/rg0 (normal, advanced_zoned checksums)
                                                              Usable Physical
     Position Disk                        Pool Type     RPM     Size     Size Status
     -------- --------------------------- ---- ----- ------ -------- -------- ----------
     shared   NET-3.2                      1   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-3.3                      1   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-3.4                      1   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-3.5                      1   SSD        -  205.1GB  447.1GB (normal)
     shared   NET-3.12                     1   SSD        -  205.1GB  447.1GB (normal)
10 entries were displayed..
----
[NOTE]
====
Per testare o simulare uno o più guasti dell'unità, utilizzare `storage disk fail -disk NET-x.y -immediate` comando. Se nel sistema è presente una riserva, l'aggregato inizierà la ricostruzione.  È possibile verificare lo stato della ricostruzione utilizzando il comando `storage aggregate show` . possibile rimuovere l'unità simulata guasta utilizzando ONTAP Deploy.  Si noti che ONTAP ha contrassegnato l'unità come `Broken` . L'unità non è effettivamente danneggiata e può essere aggiunta nuovamente utilizzando ONTAP Deploy. Per cancellare l'etichetta "Danneggiata", immettere i seguenti comandi nella CLI ONTAP Select

[listing]
----
set advanced
disk unfail -disk NET-x.y -spare true
disk show -broken
----
L'output dell'ultimo comando dovrebbe essere vuoto.

====


== NVRAM virtualizzata

I sistemi NetApp FAS sono tradizionalmente dotati di una scheda PCI NVRAM fisica. Questa scheda è una scheda ad alte prestazioni contenente memoria flash non volatile che offre un significativo incremento delle prestazioni di scrittura. Ciò è possibile grazie alla capacità di ONTAP di confermare immediatamente le scritture in arrivo al client. Può anche pianificare lo spostamento dei blocchi di dati modificati su supporti di memorizzazione più lenti, in un processo noto come destaging.

I sistemi standard non sono in genere dotati di questo tipo di apparecchiatura. Pertanto, la funzionalità della scheda NVRAM è stata virtualizzata e inserita in una partizione sul disco di avvio del sistema ONTAP Select . Per questo motivo, il posizionamento del disco virtuale di sistema dell'istanza è estremamente importante.
